<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>eSense Photo Album</title>
    <link rel="stylesheet" href="css/fonts.css" />
    <link rel="stylesheet" href="css/panel-style.css" />
    <link rel="stylesheet" href="css/animate.css" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/bootstrap4-toggle.min.css" />
    <link
      rel="stylesheet"
      href="https://cdn.linearicons.com/free/1.0.0/icon-font.min.css"
    />
    <link rel="stylesheet" href="css/foundations.min.css" />

    <script src="js/jquery.min.js"></script>
    <script src="js/socket.io.js"></script>
    <script src="js/smoothie.js"></script>
    <script src="js/panel-main.js"></script>
    <script src="js/bootstrap4-toggle.min.js"></script>
    <script src="js/three.js"></script>
    <script type="text/javascript" src="js/amplitude.min.js"></script>
    <script src="js/control-player.js"></script>
    <script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="module">
        import interact from 'https://cdn.jsdelivr.net/npm/@interactjs/interactjs/index.js';

        var folder = "images/";

        var elements = [];
        var divElements = [];
        var offsetLeft = 0;
        var offsetTop = 0;
        var offsetWidth = 0;
        var offsetHeight = 0;
        var offsetRight = 0;
        var offsetBottom = 0;

        var widthString = 0;
        var heightString = 0;

        var scaledWidth = 0;
        var scaledHeight = 0;

        var origin = 0;

        var padding = 100;

        // Get images from folder and add them in rows and columns
        $(document).ready(function() {
            $.ajax({
                url : folder,
                success: function (data) {
                    $(data).find("a").attr("href", function (i, val) {

                        var queryString = window.location.search;

                        if (queryString) {
                          queryString = queryString.split("&");

                          var firstEntry = queryString[0].split("=");
                          
                          firstEntry[0] = firstEntry[0].substring(1);
                          var secondEntry = queryString[1].split("=");

                          if (firstEntry[0].includes("Picture")) {
                            var firstImage = firstEntry[1];
                            var secondImage = secondEntry[1];

                            if( val.match(/\.(jpe?g)$/) && val != firstImage && val != secondImage) {
                            $(".row").append( "<div class='column grow'> <img src='.." + val +"' id='" + val +"' style='width:50%' class='images wiggle grid-snap' onmouseover='onHover(this)' onmouseout='clearTime(this)'/> </div>" );
                            var name = val.substring(8);
                            } else if( val.includes("Album") || val == firstImage) {
                                $(".row").append( "<div class='column grow'> <img src='../images/Folder-Icon.png' id='" + val +"' style='width:50%' class='images wiggle grid-snap' onmouseover='onHover(this)' onmouseout='clearTime(this)'/> </div>" );
                                var name = val.substring(8);
                            } 
                          }

                          if (firstEntry[0].includes("Album")) {
                            var firstAlbum = firstEntry[1];
                            var secondAlbum = secondEntry[1];

                            if( val.match(/\.(jpe?g)$/)) {
                            $(".row").append( "<div class='column grow'> <img src='.." + val +"' id='" + val +"' style='width:50%' class='images wiggle grid-snap' onmouseover='onHover(this)' onmouseout='clearTime(this)'/> </div>" );
                            var name = val.substring(8);
                            } else if( val.includes("Album") && val != firstAlbum) {
                                $(".row").append( "<div class='column grow'> <img src='../images/Folder-Icon.png' id='" + val +"' style='width:50%' class='images wiggle grid-snap' onmouseover='onHover(this)' onmouseout='clearTime(this)'/> </div>" );
                                var name = val.substring(8);
                            } 
                          }

                          
                        } else {
                            if( val.match(/\.(jpe?g)$/) ) {
                            $(".row").append( "<div class='column grow'> <img src='.." + val +"' id='" + val +"' style='width:50%' class='images wiggle grid-snap' onmouseover='onHover(this)' onmouseout='clearTime(this)'/> </div>" );
                            var name = val.substring(8);
                            } else if( val.includes("Album") ) {
                                $(".row").append( "<div class='column grow'> <img src='../images/Folder-Icon.png' id='" + val +"' style='width:50%' class='images wiggle grid-snap' onmouseover='onHover(this)' onmouseout='clearTime(this)'/> </div>" );
                                var name = val.substring(8);
                            }
                        }
                        
                    });
                    callWhag(elements);
                }
            });
        });

        function callWhag(elements) {
            elements = document.getElementsByClassName("images");

            offsetLeft = elements[0].offsetLeft;
            offsetTop = elements[0].offsetTop;
            offsetWidth = elements[0].offsetWidth;
            offsetHeight = elements[0].offsetHeight;
            offsetRight = offsetLeft + offsetWidth;
            offsetBottom = offsetTop + offsetHeight;

            widthString = offsetWidth + "px";
            heightString = offsetHeight + "px";

            scaledWidth = offsetWidth * 1.5;
            scaledHeight = offsetHeight * 1.5;

            scaledWidth = scaledWidth + "px";
            scaledHeight = scaledHeight + "px";

            divElements = document.getElementsByClassName("column");
        }

        // Gets current mouse position
        // TODO: do for all images
        function coordinate(event) {

             // clientX gives horizontal coordinate
             var x = event.pageX;

             // clientY gives vertical coordinates
             var y = event.pageY;

             // <!--console.log('absolute x', x);-->
             // <!--console.log('absolute y', y);-->

             var temp = elements.item(1);

             // <!--console.log(temp.offsetLeft);-->

             // if el2 is within region, translate the element until it snaps to el1
          }

      
    

        // target elements with the "draggable" class
        interact('.draggable')
          .draggable({
            // enable inertial throwing
            inertia: true,
            // keep the element within the area of it's parent
            modifiers: [
              interact.modifiers.restrictRect({
                restriction: 'parent',
                endOnly: true
              })
            ],
            // enable autoScroll
            autoScroll: true,

            listeners: {
              // call this function on every dragmove event
              move: dragMoveListener,

              // call this function on every dragend event
              end (event) {
                var textEl = event.target.querySelector('p')

                textEl && (textEl.textContent =
                  'moved a distance of ' +
                  (Math.sqrt(Math.pow(event.pageX - event.x0, 2) +
                             Math.pow(event.pageY - event.y0, 2) | 0))
                    .toFixed(2) + 'px')
              }
            }
          })

        function dragMoveListener (event) {
          var target = event.target
          // keep the dragged position in the data-x/data-y attributes
          var x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx
          var y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy

          // translate the element
          target.style.webkitTransform =
            target.style.transform =
              'translate(' + x + 'px, ' + y + 'px)'

          // update the posiion attributes
          target.setAttribute('data-x', x)
          target.setAttribute('data-y', y)
        }

        // this function is used later in the resizing and gesture demos
        window.dragMoveListener = dragMoveListener

        var example = document.getElementById('grid-snap')
        var x = 0; var y = 0

        interact(example)
          .draggable({
            modifiers: [
              interact.modifiers.snap({
                targets: [
                  interact.createSnapGrid({ x: 30, y: 30 })
                ],
                range: Infinity,
                relativePoints: [ { x: 0, y: 0 } ]
              }),
              interact.modifiers.restrict({
                restriction: example.parentNode,
                elementRect: { top: 0, left: 0, bottom: 1, right: 1 },
                endOnly: true
              })
            ],
            inertia: true
          })
          .on('dragmove', function (event) {
            x += event.dx
            y += event.dy

            event.target.style.webkitTransform =
            event.target.style.transform =
                'translate(' + x + 'px, ' + y + 'px)'
          })

    </script>
  </head>

  <body>
  <!-- <body onmousemove="coordinate(event)"> -->
    <div class="container-fluid">
      <div class="top-pane">
        <!--<div class="col-lg-1"><img src="images/eSense.png" /></div>-->
        <div class="col-lg-11" style="padding-top:30px; text-align:left;">
          eSense Photo Album
        </div>
      </div>

      <script>
        var timeoutId = null;
        var currentElement = null;

        // Return to normal size when leave image
        function clearTime(x) {
             window.clearTimeout(timeoutId);
        }

        function onHover(x) {
          timeoutId = window.setTimeout(function(){
            currentElement = x;
            console.log(currentElement);
            if (currentElement.id.includes("Album")) {
              document.getElementById("albumMenu").style.display = "block";
            } else {
               document.getElementById("photoMenu").style.display = "block";
            }
           }, 1000);
        }

        function onBackHover() {
          timeoutId = window.setTimeout(function(){
             document.getElementById("photoMenu").style.display = "none";
             document.getElementById("albumMenu").style.display = "none";
           }, 1000);
        }

        function onDeleteHover() {
          timeoutId = window.setTimeout(function(){
             document.getElementById("deleteMenu").style.display = "block";
           }, 1000);
        }

        function onDeleteBackHover() {
          timeoutId = window.setTimeout(function(){
            document.getElementById("deleteMenu").style.display = "none";
           }, 1000);
        }

        function onConfirmDeleteHover() {
          timeoutId = window.setTimeout(function(){
            document.getElementById("photoMenu").style.display = "none";
            document.getElementById("deleteMenu").style.display = "none";
            currentElement.parentNode.removeChild(currentElement);
            currentElement = null;

           }, 1000);
        }

        function onOpenPhotoHover() {
          timeoutId = window.setTimeout(function(){
            var currentDiv = document.getElementById("full-sized-photo");
            currentDiv.style.display = "block";   

            var copiedImage = currentElement.cloneNode(true); 
            copiedImage.classList.remove("wiggle");  

            var displayImage = document.createElement("div");
            displayImage.setAttribute("class", "large-photo-popup");
            displayImage.setAttribute("id", "open-photo-display");


            displayImage.appendChild(copiedImage);

            currentDiv.appendChild(displayImage);
           }, 1000);
        }

        function onPhotoBackHover() {
          timeoutId = window.setTimeout(function(){
            document.getElementById("full-sized-photo").style.display = "none";
            document.getElementById("open-photo-display").style.display = "none";
           }, 1000);
        }


        function onOpenAlbumHover() {
          timeoutId = window.setTimeout(function(){
            var albumName = currentElement.id;
            location.href = '/open-album?' + albumName;
           }, 1000);
        }

        function onAddToAlbumHover() {
          timeoutId = window.setTimeout(function(){
            var albumName = currentElement.id;
            location.href = '/add-to-album?' + albumName;
           }, 1000);
        }

        function onCreateAnAlbumHover() {
          timeoutId = window.setTimeout(function(){
            var pictureName = currentElement.id;
            location.href = '/create-an-album?' + pictureName;
           }, 1000);
        }

      </script>

<!-- 
      <div id="grid-snap" onmouseover='onHover(this)'>
        Dragging is constrained to the corners of a grid
      </div>   -->

      <div class="photo-menu-popup" id="photoMenu">

        <div class="popup-column" id="hidden">
          <button type="button" class="first-btn">hidden</button>
        </div>
        <div class="popup-column grow" id="create-album">
          <button type="button" class="first-btn wiggle" onmouseover='onCreateAnAlbumHover()' onmouseout='clearTime(this)'>Create an Album</button>
        </div>
        <div class="popup-column" id="hidden">
          <button type="button" class="first-btn">hidden</button>
        </div>

        <div class="popup-column grow" id="open-photo">
          <button type="button" class="first-btn wiggle" onmouseover='onOpenPhotoHover()' onmouseout='clearTime(this)'>Open Photo</button>
        </div>
        <div class="popup-column" id="hidden">
          <button type="button" class="first-btn">hidden</button>
        </div>
        <div class="popup-column grow" id="delete-photo">
          <button type="button" class="first-btn wiggle"  onmouseover='onDeleteHover()' onmouseout='clearTime(this)'>Delete Photo</button>
        </div>

        <div class="popup-column" id="hidden">
          <button type="button" class=first-"btn">hidden</button>
        </div>
        <div class="popup-column grow" id="Back">
          <button type="button" class="first-btn wiggle" onmouseover='onBackHover()' onmouseout='clearTime(this)'>Back</button>
        </div>
        <div class="popup-column" id="hidden">
          <button type="button" class=first-"btn">hidden</button>
        </div>

      </div>


      <div class="album-menu-popup" id="albumMenu">

        <div class="popup-column" id="hidden">
          <button type="button" class="first-btn">hidden</button>
        </div>
        <div class="popup-column grow" id="add-to-another-album">
          <button type="button" class="first-btn wiggle" onmouseover='onAddToAlbumHover()' onmouseout='clearTime(this)'>Add to Another Album</button>
        </div>
        <div class="popup-column" id="hidden">
          <button type="button" class="first-btn">hidden</button>
        </div>

        <div class="popup-column grow" id="open-album">
          <button type="button" class="first-btn wiggle" onmouseover='onOpenAlbumHover()' onmouseout='clearTime(this)'>Open Album</button>
        </div>
        <div class="popup-column" id="hidden">
          <button type="button" class="first-btn">hidden</button>
        </div>
        <div class="popup-column grow" id="delete-album">
          <button type="button" class="first-btn wiggle"  onmouseover='onDeleteHover()' onmouseout='clearTime(this)'>Delete Album</button>
        </div>

        <div class="popup-column" id="hidden">
          <button type="button" class=first-"btn">hidden</button>
        </div>
        <div class="popup-column grow" id="Back">
          <button type="button" class="first-btn wiggle" onmouseover='onBackHover()' onmouseout='clearTime(this)'>Back</button>
        </div>
        <div class="popup-column" id="hidden">
          <button type="button" class=first-"btn">hidden</button>
        </div>

      </div>

      <div class="delete-popup" id="deleteMenu">
        <div class="popup-column" id="hidden">
          <button type="button" class="second-btn">hidden</button>
        </div>
        <div class="popup-column grow" id="confirm-deletion">
          <button type="button" class="second-btn wiggle" onmouseover='onConfirmDeleteHover()' onmouseout='clearTime(this)'>Confirm Deletion</button>
        </div>
        <div class="popup-column" id="hidden">
          <button type="button" class="second-btn">hidden</button>
        </div>

        <div class="popup-column grow" id="hidden">
          <button type="button" class="second-btn wiggle">hidden</button>
        </div>
        <div class="popup-column" id="hidden">
          <button type="button" class="second-btn">hidden</button>
        </div>
        <div class="popup-column grow" id="hidden">
          <button type="button" class="second-btn wiggle">hidden</button>
        </div>

        <div class="popup-column" id="hidden">
          <button type="button" class="second-btn">hidden</button>
        </div>
        <div class="popup-column grow" id="Back">
          <button type="button" class="second-btn wiggle" onmouseover='onDeleteBackHover()' onmouseout='clearTime(this)'>Back</button>
        </div>
        <div class="popup-column" id="hidden">
          <button type="button" class="second-btn">hidden</button>
        </div>
      </div>

      <div class="photo-popup" id="full-sized-photo">
        <div class="popup-column" id="hidden">
          <button type="button" class="second-btn">hidden</button>
        </div>
        <div class="popup-column grow" id="hidden">
          <button type="button" class="second-btn wiggle">hidden</button>
        </div>
        <div class="popup-column" id="hidden">
          <button type="button" class="second-btn">hidden</button>
        </div>

        <div class="popup-column grow" id="hidden">
          <button type="button" class="second-btn wiggle">hidden</button>
        </div>
        <div class="popup-column" id="hidden">
          <button type="button" class="second-btn">hidden</button>
        </div>
        <div class="popup-column grow" id="hidden">
          <button type="button" class="second-btn wiggle">hidden</button>
        </div>

        <div class="popup-column" id="hidden">
          <button type="button" class="second-btn">hidden</button>
        </div>
        <div class="popup-column grow" id="hidden">
          <button type="button" class="second-btn wiggle">hidden</button>
        </div>
        <div class="popup-column" id="hidden">
          <button type="button" class="second-btn">hidden</button>
        </div>

        <div class="popup-column" id="hidden">
          <button type="button" class="second-btn">hidden</button>
        </div>
        <div class="popup-column grow" id="Back">
          <button type="button" class="second-btn wiggle" onmouseover='onPhotoBackHover()' onmouseout='clearTime(this)'>Back</button>
        </div>
        <div class="popup-column" id="hidden">
          <button type="button" class="second-btn">hidden</button>
        </div>
      </div>

      <div class="row">

      </div>

    </div>
  </body>
</html>
